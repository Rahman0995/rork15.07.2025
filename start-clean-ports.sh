#!/bin/bash

echo "üîß –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ –∏ –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."

# –£–±–∏–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–∞ –ø–æ—Ä—Ç–∞—Ö 3000 –∏ 8081
echo "üî™ –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞ 3000..."
lsof -ti:3000 | xargs kill -9 2>/dev/null || echo "–ü–æ—Ä—Ç 3000 —Å–≤–æ–±–æ–¥–µ–Ω"

echo "üî™ –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞ 8081..."
lsof -ti:8081 | xargs kill -9 2>/dev/null || echo "–ü–æ—Ä—Ç 8081 —Å–≤–æ–±–æ–¥–µ–Ω"

echo "‚è≥ –ñ–¥–µ–º 2 —Å–µ–∫—É–Ω–¥—ã..."
sleep 2

echo "üöÄ –ó–∞–ø—É—Å–∫ backend –Ω–∞ –ø–æ—Ä—Ç—É 3000..."
node backend/index.ts &
BACKEND_PID=$!

echo "‚è≥ –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞ backend (5 —Å–µ–∫—É–Ω–¥)..."
sleep 5

echo "üì± –ó–∞–ø—É—Å–∫ frontend –Ω–∞ –ø–æ—Ä—Ç—É 8082..."
npx expo start --port 8082 --clear &
FRONTEND_PID=$!

echo "üéâ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ!"
echo "üì° Backend: http://localhost:3000"
echo "üì± Frontend: http://localhost:8082"
echo "üõë –ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏"

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
trap 'echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."; kill $BACKEND_PID $FRONTEND_PID 2>/dev/null; exit 0' INT

# –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
wait