#!/bin/bash

echo "üîß –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ñ–∞–π–ª–æ–≤—ã–º–∏ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è–º–∏..."

# –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏
chmod +x fix-file-watchers.sh
chmod +x start-without-sudo.sh

# –ü—Ä–æ–±—É–µ–º —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç —Å sudo
echo "üöÄ –ü–æ–ø—ã—Ç–∫–∞ 1: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ —Ñ–∞–π–ª–æ–≤—ã—Ö –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ–π..."
if sudo echo 524288 > /proc/sys/fs/inotify/max_user_watches 2>/dev/null; then
    echo "‚úÖ –õ–∏–º–∏—Ç —É–≤–µ–ª–∏—á–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
    
    # –û—á–∏—â–∞–µ–º –∫—ç—à
    echo "üßπ –û—á–∏—â–∞–µ–º –∫—ç—à..."
    rm -rf node_modules/.cache .expo dist 2>/dev/null || true
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ..."
    npx expo start --tunnel --port 8081 --clear
else
    echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç —Å sudo"
    echo "üîÑ –ü–æ–ø—ã—Ç–∫–∞ 2: –ó–∞–ø—É—Å–∫ —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏..."
    
    # –û—á–∏—â–∞–µ–º –∫—ç—à
    rm -rf node_modules/.cache .expo dist 2>/dev/null || true
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
    export WATCHMAN_DISABLE_RECRAWL=true
    export EXPO_NO_DOTENV=1
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
    npx expo start --tunnel --port 8081 --clear --no-dev
fi