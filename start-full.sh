#!/bin/bash

echo "üöÄ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (frontend + backend)..."

# –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏
chmod +x start-app.sh
chmod +x start-backend.sh

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ —Ñ–∞–π–ª–æ–≤—ã—Ö –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ–π
fix_watchers() {
    echo "üîß –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–æ–±–ª–µ–º—É —Å —Ñ–∞–π–ª–æ–≤—ã–º–∏ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è–º–∏..."
    
    # –ü—Ä–æ–±—É–µ–º —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç
    if echo 524288 | sudo tee /proc/sys/fs/inotify/max_user_watches >/dev/null 2>&1; then
        echo "‚úÖ –õ–∏–º–∏—Ç —Ñ–∞–π–ª–æ–≤—ã—Ö –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ–π —É–≤–µ–ª–∏—á–µ–Ω"
        return 0
    else
        echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç (–ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å sudo)"
        return 1
    fi
}

# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
clean_cache() {
    echo "üßπ –û—á–∏—â–∞–µ–º –∫—ç—à..."
    rm -rf node_modules/.cache 2>/dev/null || true
    rm -rf .expo 2>/dev/null || true
    rm -rf dist 2>/dev/null || true
    echo "‚úÖ –ö—ç—à –æ—á–∏—â–µ–Ω"
}

# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
main() {
    # –û—á–∏—â–∞–µ–º –∫—ç—à
    clean_cache
    
    # –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–æ–±–ª–µ–º—É —Å —Ñ–∞–π–ª–æ–≤—ã–º–∏ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è–º–∏
    fix_watchers
    
    echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ..."
    echo "üì± Frontend –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8081"
    echo "üîß Backend –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3000"
    echo ""
    echo "–î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C"
    echo ""
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º frontend
    npx expo start --tunnel --port 8081 --clear
}

# –ó–∞–ø—É—Å–∫–∞–µ–º
main