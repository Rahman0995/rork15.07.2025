# Military Management System - Backend\n\nBackend API для системы управления военным подразделением, построенный на tRPC и Hono.\n\n## Архитектура\n\n### Технологический стек\n- **Framework**: Hono.js\n- **API**: tRPC\n- **Validation**: Zod\n- **TypeScript**: Полная типизация\n- **Mock Data**: Для демонстрации функциональности\n\n### Структура проекта\n```\nbackend/\n├── config/           # Конфигурация приложения\n├── trpc/            # tRPC роутеры и middleware\n│   ├── routes/      # API endpoints по модулям\n│   │   ├── auth/    # Аутентификация\n│   │   ├── users/   # Пользователи\n│   │   ├── reports/ # Отчеты\n│   │   ├── tasks/   # Задачи\n│   │   ├── chat/    # Чат\n│   │   ├── calendar/# События календаря\n│   │   ├── notifications/ # Уведомления\n│   │   ├── analytics/     # Аналитик��\n│   │   └── media/   # Файлы и медиа\n│   ├── app-router.ts     # Главный роутер\n│   ├── create-context.ts # Контекст tRPC\n│   └── middleware.ts     # Middleware функции\n├── utils/           # Утилиты\n│   ├── auth.ts      # Аутентификация и авторизация\n│   ├── database.ts  # Работа с базой данных\n│   └── validation.ts # Схемы валидации\n└── hono.ts          # Главный файл сервера\n```\n\n## API Endpoints\n\n### Аутентификация (`/api/trpc/auth`)\n- `login` - Вход в систему\n- `logout` - Выход из системы\n- `refreshToken` - Обновление токена\n- `changePassword` - Смена пароля\n- `resetPassword` - Сброс пароля\n\n### Пользователи (`/api/trpc/users`)\n- `getAll` - Получить всех пользователей\n- `getById` - Получить пользователя по ID\n- `getByUnit` - Получить пользователей по подразделению\n- `getCurrent` - Получить текущего пользователя\n- `update` - Обновить данные пользователя\n\n### Отчеты (`/api/trpc/reports`)\n- `getAll` - Получить все отчеты (с фильтрацией)\n- `getById` - Получить отчет по ID\n- `create` - Создать новый отчет\n- `update` - Обновить отчет\n- `delete` - Удалить отчет\n- `addComment` - Добавить комментарий к отчету\n- `approve` - Одобрить/отклонить отчет\n- `getForApproval` - Получить отчеты для одобрения\n\n### Задачи (`/api/trpc/tasks`)\n- `getAll` - Получить все задачи (с фильтрацией)\n- `getById` - Получить задачу по ID\n- `create` - Создать новую задачу\n- `update` - Обновить задачу\n- `delete` - Удалить задачу\n- `getStats` - Получить статистику по задачам\n\n### Чат (`/api/trpc/chat`)\n- `getAll` - Получить все чаты пользователя\n- `getById` - Получить чат по ID\n- `getMessages` - Получить сообщения чата\n- `sendMessage` - Отправить сообщение\n- `markAsRead` - Отметить сообщения как прочитанные\n- `create` - Создать новый чат\n- `delete` - Удалить чат\n- `getUnreadCount` - Получить количество непрочитанных сообщений\n\n### Календарь (`/api/trpc/calendar`)\n- `getEvents` - Получить события (с фильтрацией)\n- `getById` - Получить событие по ID\n- `create` - Создать новое событие\n- `update` - Обновить событие\n- `delete` - Удалить событие\n- `getUpcoming` - Получить предстоящие события\n\n### Уведомления (`/api/trpc/notifications`)\n- `getAll` - Получить все уведомления\n- `markAsRead` - Отметить уведомление как прочитанное\n- `markAllAsRead` - Отметить все уведомления как прочитанные\n- `create` - Создать новое уведомление\n- `delete` - Удалить уведомление\n- `getUnreadCount` - Получить количество непрочитанных уведомлений\n\n### Аналитика (`/api/trpc/analytics`)\n- `getReportsAnalytics` - Аналитика по отчетам\n- `getTasksAnalytics` - Аналитика по задачам\n- `getUserActivity` - Активность пользователя\n- `getDashboardStats` - Статистика для дашборда\n\n### Медиа (`/api/trpc/media`)\n- `upload` - Загрузить файл\n- `getAll` - Получить все файлы\n- `getById` - Получить файл по ID\n- `delete` - Удалить файл\n- `generateUploadUrl` - Сгенерировать URL для загрузки\n- `getStorageStats` - Статистика хранилища\n\n## Middleware\n\n### Логирование\n- Автоматическое логирование всех запросов\n- Измерение времени выполнения\n- Логирование ошибок\n\n### Обработка ошибок\n- Централизованная обработка ошибок\n- Стандартизированные ответы об ошибках\n- Логирование неожиданных ошибок\n\n### Аутентификация (готово к использованию)\n- Проверка JWT токенов\n- Извлечение данных пользователя из токена\n- Защищенные endpoints\n\n### Авторизация (готово к использованию)\n- Проверка ролей пользователей\n- Иерархия доступа\n- Гибкая система разрешений\n\n### Rate Limiting\n- Ограничение частоты запросов\n- Защита от DDoS атак\n- Настраиваемые лимиты\n\n## Валидация\n\n### Схемы Zod\n- Валидация входных данных\n- Типобезопасность\n- Автоматическая генерация TypeScript типов\n\n### Пользовательские валидаторы\n- Валидация email, телефона, паролей\n- Проверка размеров и типов файлов\n- Бизнес-логика валидации\n\n## Безопасность\n\n### Аутентификация\n- JWT токены\n- Refresh токены\n- Хеширование паролей (bcrypt)\n\n### Авторизация\n- Ролевая модель доступа\n- Проверка прав на уровне endpoints\n- Иерархия военных званий\n\n### Защита данных\n- Валидация всех входных данных\n- Санитизация пользовательского ввода\n- CORS настройки\n\n## Конфигурация\n\n### Переменные окружения\n```env\n# Сервер\nPORT=3001\nHOST=localhost\nNODE_ENV=development\n\n# База данных\nDATABASE_URL=postgresql://localhost:5432/military_app\nDB_MAX_CONNECTIONS=10\n\n# Аутентификация\nJWT_SECRET=your-secret-key\nJWT_EXPIRES_IN=24h\nREFRESH_TOKEN_EXPIRES_IN=7d\nBCRYPT_ROUNDS=12\n\n# Файловое хранилище\nSTORAGE_PROVIDER=local\nUPLOAD_DIR=./uploads\nMAX_FILE_SIZE=10485760\n\n# Redis\nREDIS_URL=redis://localhost:6379\nREDIS_TTL=3600\n\n# Email\nEMAIL_PROVIDER=smtp\nSMTP_HOST=localhost\nSMTP_PORT=587\nSMTP_USER=\nSMTP_PASS=\nEMAIL_FROM=noreply@military-app.com\n\n# Логирование\nLOG_LEVEL=info\nLOG_FORMAT=json\nLOG_FILE=./logs/app.log\n\n# Rate Limiting\nRATE_LIMIT_WINDOW_MS=900000\nRATE_LIMIT_MAX=100\n\n# Уведомления\nPUSH_NOTIFICATIONS_ENABLED=false\nEMAIL_NOTIFICATIONS_ENABLED=true\n\n# Безопасность\nSESSION_SECRET=your-session-secret\nSESSION_MAX_AGE=86400000\n\n# Разработка\nUSE_MOCK_DATA=true\nSEED_DATABASE=false\nENABLE_PLAYGROUND=true\n\n# Мониторинг\nMONITORING_ENABLED=false\n```\n\n## Развертывание\n\n### Разработка\n```bash\n# Установка зависимостей\nnpm install\n\n# Запуск в режиме разработки\nnpm run dev\n\n# Проверка типов\nnpm run type-check\n\n# Линтинг\nnpm run lint\n```\n\n### Продакшн\n```bash\n# Сборка\nnpm run build\n\n# Запуск\nnpm start\n```\n\n### Docker\n```dockerfile\nFROM node:18-alpine\nWORKDIR /app\nCOPY package*.json ./\nRUN npm ci --only=production\nCOPY . .\nEXPOSE 3001\nCMD [\"npm\", \"start\"]\n```\n\n## Мониторинг и логирование\n\n### Логи\n- Структурированные JSON логи\n- Р��тация логов\n- Различные уровни логирования\n\n### Метрики\n- Время ответа API\n- Количество запросов\n- Ошибки и их частота\n\n### Здоровье системы\n- Health check endpoints\n- Мониторинг базы данных\n- Проверка внешних сервисов\n\n## Тестирование\n\n### Unit тесты\n- Тестирование бизнес-логики\n- Мокирование зависимостей\n- Покрытие кода\n\n### Integration тесты\n- Тестирование API endpoints\n- Тестирование базы данных\n- End-to-end тесты\n\n## Производительность\n\n### Кеширование\n- Redis для кеширования\n- Кеширование запросов к БД\n- Кеширование статических данных\n\n### Оптимизация запросов\n- Пагинация\n- Фильтрация на уровне БД\n- Индексы базы данных\n\n### Масштабирование\n- Горизонтальное масштабирование\n- Load balancing\n- Микросервисная архитектура (готовность)\n\n## Документация API\n\n### tRPC\n- Автоматическая генерация типов\n- Type-safe клиент\n- Встроенная документация\n\n### OpenAPI (опционально)\n- Swagger документация\n- Интерактивная документация\n- Генерация клиентов\n\n## Миграции и семена\n\n### Миграции базы данных\n- Версионирование схемы БД\n- Откат миграций\n- Автоматическое применение\n\n### Seed данные\n- Начальные данные для разработки\n- Тестовые данные\n- Демо данные\n\n## Интеграции\n\n### Внешние сервисы\n- Email сервисы\n- Push уведомления\n- Файловые хранилища (S3, GCS)\n\n### Webhooks\n- Уведомления о событиях\n- Интеграция с внешними системами\n- Обработка callback'ов\n\n## Безопасность данных\n\n### Шифрование\n- Шифрование чувствительных данных\n- HTTPS обязательно в продакшн\n- Шифрование файлов\n\n### Аудит\n- Логирование всех действий\n- Отслеживание изменений\n- Compliance требования\n\n### Backup\n- Регулярные бэкапы БД\n- Восстановление данных\n- Disaster recovery план"